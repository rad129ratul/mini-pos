import{d as l,e,p as v,m as p,v as w,o as i,t as d,n as k,g as u,q as T,F as S,i as x,r as _,f as C,h as I,s as Q,u as P,x as F}from"./vendor-D4pjJ2_S.js";import{_ as y,u as h}from"./app-CtrPb6go.js";import{M}from"./bootstrap-DDJ2Weqf.js";import{s as D}from"./saleService-CiGuVxoJ.js";import{p as q,c as V}from"./categoryService-B-PhpuPW.js";import"./api-DPQzmjXj.js";const A={name:"SearchBar",data(){return{searchQuery:"",debounceTimer:null}},methods:{handleSearch(){clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this.$emit("search",this.searchQuery)},500)},clearSearch(){this.searchQuery="",this.$emit("search","")}}},B={class:"input-group input-group-lg"};function L(s,t,a,c,n,r){return i(),l("div",B,[t[4]||(t[4]=e("span",{class:"input-group-text"},[e("i",{class:"bi bi-search"})],-1)),v(e("input",{type:"text",class:"form-control",placeholder:"Search products by name or barcode...","onUpdate:modelValue":t[0]||(t[0]=o=>n.searchQuery=o),onInput:t[1]||(t[1]=(...o)=>r.handleSearch&&r.handleSearch(...o))},null,544),[[w,n.searchQuery]]),n.searchQuery?(i(),l("button",{key:0,class:"btn btn-outline-secondary",type:"button",onClick:t[2]||(t[2]=(...o)=>r.clearSearch&&r.clearSearch(...o))},[...t[3]||(t[3]=[e("i",{class:"bi bi-x-lg"},null,-1)])])):p("",!0)])}const E=y(A,[["render",L]]),U={name:"ProductCard",props:{product:{type:Object,required:!0}},computed:{stockClass(){return this.product.stock_quantity<=0?"text-danger":this.product.stock_quantity<10?"text-warning":"text-success"}},methods:{formatPrice(s){return parseFloat(s).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},handleClick(){this.product.stock_quantity>0&&this.$emit("click",this.product)}}},j={class:"card h-100 product-card"},G=["src","alt"],K={class:"card-body"},N={class:"card-title fw-bold"},O={class:"card-text text-primary fw-bold fs-5 mb-2"},R={class:"card-text small mb-3"},z=["disabled"];function H(s,t,a,c,n,r){return i(),l("div",j,[e("img",{src:a.product.image||"https://via.placeholder.com/300",class:"card-img-top",alt:a.product.name},null,8,G),e("div",K,[e("h6",N,d(a.product.name),1),e("p",O," ৳"+d(r.formatPrice(a.product.price)),1),e("p",R,[e("span",{class:k(r.stockClass)},[t[1]||(t[1]=e("i",{class:"bi bi-box-seam me-1"},null,-1)),u(" Stock: "+d(a.product.stock_quantity),1)],2)]),e("button",{class:"btn btn-primary w-100",disabled:a.product.stock_quantity<=0,onClick:t[0]||(t[0]=T((...o)=>r.handleClick&&r.handleClick(...o),["stop"]))},[t[2]||(t[2]=e("i",{class:"bi bi-cart-plus me-1"},null,-1)),u(" "+d(a.product.stock_quantity>0?"Add to Cart":"Out of Stock"),1)],8,z)])])}const J=y(U,[["render",H],["__scopeId","data-v-901f5459"]]),W={name:"ProductGrid",components:{ProductCard:J},props:{products:{type:Array,default:()=>[]}},data(){return{loading:!1}},emits:["add-to-cart"]},X={key:0,class:"text-center py-5"},Y={key:1,class:"text-center py-5"},Z={key:2,class:"row g-3"};function $(s,t,a,c,n,r){const o=_("ProductCard");return i(),l("div",null,[n.loading?(i(),l("div",X,[...t[0]||(t[0]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("p",{class:"mt-2"},"Loading products...",-1)])])):a.products.length===0?(i(),l("div",Y,[...t[1]||(t[1]=[e("i",{class:"bi bi-box-seam fs-1 text-muted"},null,-1),e("p",{class:"mt-3 text-muted"},"No products found",-1)])])):(i(),l("div",Z,[(i(!0),l(S,null,x(a.products,b=>(i(),l("div",{key:b.id,class:"col-12 col-md-6 col-lg-4"},[C(o,{product:b,onClick:m=>s.$emit("add-to-cart",b)},null,8,["product","onClick"])]))),128))]))])}const tt=y(W,[["render",$]]),g=I("cart",{state:()=>({items:[]}),getters:{cartCount:s=>s.items.reduce((t,a)=>t+a.quantity,0),subtotal:s=>s.items.reduce((t,a)=>t+a.price*a.quantity,0),tax:s=>s.items.reduce((t,a)=>t+a.price*a.quantity,0)*.1,grandTotal(){return this.subtotal+this.tax}},actions:{addItem(s){const t=this.items.find(a=>a.product.id===s.id);t?t.quantity++:this.items.push({product:s,quantity:1,price:s.price})},removeItem(s){this.items=this.items.filter(t=>t.product.id!==s)},updateQuantity(s,t){const a=this.items.find(c=>c.product.id===s);a&&(a.quantity=t)},clearCart(){this.items=[]}}}),et={name:"CartItem",props:{item:{type:Object,required:!0}},setup(){return{cartStore:g()}},methods:{formatPrice(s){return parseFloat(s).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},increaseQuantity(){this.item.quantity<this.item.product.stock_quantity&&this.cartStore.updateQuantity(this.item.product.id,this.item.quantity+1)},decreaseQuantity(){this.item.quantity>1&&this.cartStore.updateQuantity(this.item.product.id,this.item.quantity-1)},updateQuantity(s){const t=parseInt(s.target.value);t>0&&t<=this.item.product.stock_quantity&&this.cartStore.updateQuantity(this.item.product.id,t)},removeItem(){this.cartStore.removeItem(this.item.product.id)}}},st={class:"list-group-item d-flex justify-content-between align-items-center"},rt={class:"flex-grow-1"},ot={class:"mb-1"},at={class:"text-muted"},nt={class:"d-flex align-items-center gap-2"},it={class:"btn-group btn-group-sm",role:"group"},lt=["disabled"],dt=["value","max"],ct=["disabled"],ut={class:"text-end",style:{"min-width":"80px"}};function mt(s,t,a,c,n,r){return i(),l("div",st,[e("div",rt,[e("h6",ot,d(a.item.product.name),1),e("small",at,"৳"+d(r.formatPrice(a.item.price))+" each",1)]),e("div",nt,[e("div",it,[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[0]||(t[0]=(...o)=>r.decreaseQuantity&&r.decreaseQuantity(...o)),disabled:a.item.quantity<=1},[...t[4]||(t[4]=[e("i",{class:"bi bi-dash"},null,-1)])],8,lt),e("input",{type:"number",class:"form-control text-center",style:{width:"60px"},value:a.item.quantity,onInput:t[1]||(t[1]=(...o)=>r.updateQuantity&&r.updateQuantity(...o)),min:"1",max:a.item.product.stock_quantity},null,40,dt),e("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[2]||(t[2]=(...o)=>r.increaseQuantity&&r.increaseQuantity(...o)),disabled:a.item.quantity>=a.item.product.stock_quantity},[...t[5]||(t[5]=[e("i",{class:"bi bi-plus"},null,-1)])],8,ct)]),e("div",ut,[e("strong",null,"৳"+d(r.formatPrice(a.item.price*a.item.quantity)),1)]),e("button",{type:"button",class:"btn btn-sm btn-danger",onClick:t[3]||(t[3]=(...o)=>r.removeItem&&r.removeItem(...o))},[...t[6]||(t[6]=[e("i",{class:"bi bi-x-lg"},null,-1)])])])])}const ht=y(et,[["render",mt],["__scopeId","data-v-5e8871e1"]]),bt={name:"CheckoutModal",data(){return{modalInstance:null,form:{customer_name:"",payment_method:"cash",amount_received:0},loading:!1,error:null}},setup(){const s=g(),t=h();return{cartStore:s,toastStore:t}},computed:{change(){return this.form.payment_method==="cash"&&this.form.amount_received?Math.max(0,this.form.amount_received-this.cartStore.grandTotal):0},amountError(){return this.form.payment_method==="cash"&&this.form.amount_received>0&&this.form.amount_received<this.cartStore.grandTotal},isValid(){return this.form.payment_method?this.form.payment_method==="cash"?this.form.amount_received>=this.cartStore.grandTotal:!0:!1}},mounted(){this.modalInstance=new M(this.$refs.modal)},methods:{formatPrice(s){return parseFloat(s).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},show(){this.resetForm(),this.modalInstance.show()},close(){this.modalInstance.hide()},resetForm(){this.form={customer_name:"",payment_method:"cash",amount_received:0},this.error=null},async handleSubmit(){if(this.isValid){this.loading=!0,this.error=null;try{const s={items:this.cartStore.items.map(t=>({product_id:t.product.id,quantity:t.quantity})),payment_method:this.form.payment_method,customer_name:this.form.customer_name||null};await D.create(s),this.toastStore.success("Sale completed successfully!"),this.cartStore.clearCart(),this.close(),this.form.payment_method==="cash"&&this.change>0&&setTimeout(()=>{this.toastStore.success(`Change: ৳${this.formatPrice(this.change)}`)},500)}catch(s){this.error=s.response?.data?.error||"Failed to complete sale",this.toastStore.error(this.error)}finally{this.loading=!1}}}}},ft={class:"modal fade",ref:"modal",tabindex:"-1"},yt={class:"modal-dialog modal-lg"},pt={class:"modal-content"},_t={class:"modal-header bg-primary text-white"},gt={class:"modal-body"},vt={class:"row mb-4"},Ct={class:"col-12"},kt={class:"table-responsive"},St={class:"table table-sm"},xt={class:"text-center"},wt={class:"text-end"},Pt={class:"text-end"},qt={class:"text-end"},Tt={class:"text-end"},Qt={class:"table-primary"},It={class:"text-end"},Ft={class:"fs-5"},Mt={class:"row"},Dt={class:"col-md-6 mb-3"},Vt={class:"col-md-6 mb-3"},At={class:"d-flex gap-3"},Bt={class:"form-check"},Lt={class:"form-check"},Et={key:0,class:"col-md-6 mb-3"},Ut={key:0,class:"invalid-feedback"},jt={key:1,class:"col-md-6 mb-3"},Gt={class:"alert alert-success mb-0 py-2"},Kt={class:"fs-5"},Nt={key:0,class:"alert alert-danger"},Ot={class:"modal-footer"},Rt=["disabled"],zt=["disabled"],Ht={key:0},Jt={key:1};function Wt(s,t,a,c,n,r){return i(),Q(F,{to:"body"},[e("div",ft,[e("div",yt,[e("div",pt,[e("div",_t,[t[8]||(t[8]=e("h5",{class:"modal-title"},[e("i",{class:"bi bi-credit-card me-2"}),u("Checkout ")],-1)),e("button",{type:"button",class:"btn-close btn-close-white",onClick:t[0]||(t[0]=(...o)=>r.close&&r.close(...o))})]),e("div",gt,[e("div",vt,[e("div",Ct,[t[13]||(t[13]=e("h6",{class:"border-bottom pb-2"},"Cart Summary",-1)),e("div",kt,[e("table",St,[t[12]||(t[12]=e("thead",null,[e("tr",null,[e("th",null,"Product"),e("th",{class:"text-center"},"Qty"),e("th",{class:"text-end"},"Price"),e("th",{class:"text-end"},"Subtotal")])],-1)),e("tbody",null,[(i(!0),l(S,null,x(c.cartStore.items,o=>(i(),l("tr",{key:o.product.id},[e("td",null,d(o.product.name),1),e("td",xt,d(o.quantity),1),e("td",wt,"৳"+d(r.formatPrice(o.price)),1),e("td",Pt,"৳"+d(r.formatPrice(o.price*o.quantity)),1)]))),128))]),e("tfoot",null,[e("tr",null,[t[9]||(t[9]=e("td",{colspan:"3",class:"text-end"},[e("strong",null,"Subtotal:")],-1)),e("td",qt,"৳"+d(r.formatPrice(c.cartStore.subtotal)),1)]),e("tr",null,[t[10]||(t[10]=e("td",{colspan:"3",class:"text-end"},[e("strong",null,"Tax (10%):")],-1)),e("td",Tt,"৳"+d(r.formatPrice(c.cartStore.tax)),1)]),e("tr",Qt,[t[11]||(t[11]=e("td",{colspan:"3",class:"text-end"},[e("strong",null,"Grand Total:")],-1)),e("td",It,[e("strong",Ft,"৳"+d(r.formatPrice(c.cartStore.grandTotal)),1)])])])])])])]),e("form",{onSubmit:t[5]||(t[5]=T((...o)=>r.handleSubmit&&r.handleSubmit(...o),["prevent"]))},[e("div",Mt,[e("div",Dt,[t[14]||(t[14]=e("label",{class:"form-label"},"Customer Name (Optional)",-1)),v(e("input",{type:"text",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=o=>n.form.customer_name=o),placeholder:"Enter customer name"},null,512),[[w,n.form.customer_name]])]),e("div",Vt,[t[17]||(t[17]=e("label",{class:"form-label"},"Payment Method *",-1)),e("div",At,[e("div",Bt,[v(e("input",{class:"form-check-input",type:"radio",value:"cash","onUpdate:modelValue":t[2]||(t[2]=o=>n.form.payment_method=o),id:"cash"},null,512),[[P,n.form.payment_method]]),t[15]||(t[15]=e("label",{class:"form-check-label",for:"cash"},[e("i",{class:"bi bi-cash-stack me-1"}),u(" Cash ")],-1))]),e("div",Lt,[v(e("input",{class:"form-check-input",type:"radio",value:"card","onUpdate:modelValue":t[3]||(t[3]=o=>n.form.payment_method=o),id:"card"},null,512),[[P,n.form.payment_method]]),t[16]||(t[16]=e("label",{class:"form-check-label",for:"card"},[e("i",{class:"bi bi-credit-card me-1"}),u(" Card ")],-1))])])]),n.form.payment_method==="cash"?(i(),l("div",Et,[t[18]||(t[18]=e("label",{class:"form-label"},"Amount Received *",-1)),v(e("input",{type:"number",class:k(["form-control",{"is-invalid":r.amountError}]),"onUpdate:modelValue":t[4]||(t[4]=o=>n.form.amount_received=o),placeholder:"Enter amount",step:"0.01",min:"0"},null,2),[[w,n.form.amount_received,void 0,{number:!0}]]),r.amountError?(i(),l("div",Ut," Amount must be at least ৳"+d(r.formatPrice(c.cartStore.grandTotal)),1)):p("",!0)])):p("",!0),n.form.payment_method==="cash"&&n.form.amount_received>=c.cartStore.grandTotal?(i(),l("div",jt,[t[19]||(t[19]=e("label",{class:"form-label"},"Change",-1)),e("div",Gt,[e("strong",Kt,"৳"+d(r.formatPrice(r.change)),1)])])):p("",!0)]),n.error?(i(),l("div",Nt,d(n.error),1)):p("",!0)],32)]),e("div",Ot,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[6]||(t[6]=(...o)=>r.close&&r.close(...o)),disabled:n.loading}," Cancel ",8,Rt),e("button",{type:"button",class:"btn btn-success btn-lg",onClick:t[7]||(t[7]=(...o)=>r.handleSubmit&&r.handleSubmit(...o)),disabled:n.loading||!r.isValid},[n.loading?(i(),l("span",Ht,[...t[20]||(t[20]=[e("span",{class:"spinner-border spinner-border-sm me-2"},null,-1),u(" Processing... ",-1)])])):(i(),l("span",Jt,[...t[21]||(t[21]=[e("i",{class:"bi bi-check-circle me-2"},null,-1),u(" Complete Sale ",-1)])]))],8,zt)])])])],512)])}const Xt=y(bt,[["render",Wt],["__scopeId","data-v-d7620012"]]),Yt={name:"Cart",components:{CartItem:ht,CheckoutModal:Xt},setup(){const s=g(),t=h();return{cartStore:s,toastStore:t}},methods:{formatPrice(s){return parseFloat(s).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})},clearCart(){confirm("Are you sure you want to clear the cart?")&&(this.cartStore.clearCart(),this.toastStore.success("Cart cleared"))},openCheckout(){this.$nextTick(()=>{this.$refs.checkoutModal&&this.$refs.checkoutModal.show()})}}},Zt={class:"card shadow-sm cart-sidebar"},$t={class:"card-header bg-primary text-white"},te={class:"mb-0"},ee={key:0,class:"badge bg-light text-dark ms-2"},se={class:"card-body"},re={key:0,class:"text-center py-5"},oe={key:1},ae={class:"cart-items mb-3"},ne={class:"cart-summary"},ie={class:"d-flex justify-content-between mb-2"},le={class:"d-flex justify-content-between mb-2"},de={class:"d-flex justify-content-between mb-3"},ce={class:"fs-4 text-primary"};function ue(s,t,a,c,n,r){const o=_("CartItem"),b=_("CheckoutModal");return i(),l("div",Zt,[e("div",$t,[e("h5",te,[t[2]||(t[2]=e("i",{class:"bi bi-cart3 me-2"},null,-1)),t[3]||(t[3]=u(" Shopping Cart ",-1)),c.cartStore.cartCount>0?(i(),l("span",ee,d(c.cartStore.cartCount),1)):p("",!0)])]),e("div",se,[c.cartStore.items.length===0?(i(),l("div",re,[...t[4]||(t[4]=[e("i",{class:"bi bi-cart-x fs-1 text-muted"},null,-1),e("p",{class:"mt-3 text-muted"},"Cart is empty",-1)])])):(i(),l("div",oe,[e("div",ae,[(i(!0),l(S,null,x(c.cartStore.items,m=>(i(),Q(o,{key:m.product.id,item:m},null,8,["item"]))),128))]),t[11]||(t[11]=e("hr",null,null,-1)),e("div",ne,[e("div",ie,[t[5]||(t[5]=e("span",null,"Subtotal:",-1)),e("span",null,"৳"+d(r.formatPrice(c.cartStore.subtotal)),1)]),e("div",le,[t[6]||(t[6]=e("span",null,"Tax (10%):",-1)),e("span",null,"৳"+d(r.formatPrice(c.cartStore.tax)),1)]),t[10]||(t[10]=e("hr",null,null,-1)),e("div",de,[t[7]||(t[7]=e("strong",null,"Grand Total:",-1)),e("strong",ce,"৳"+d(r.formatPrice(c.cartStore.grandTotal)),1)]),e("button",{class:"btn btn-success btn-lg w-100 mb-2",onClick:t[0]||(t[0]=(...m)=>r.openCheckout&&r.openCheckout(...m)),type:"button"},[...t[8]||(t[8]=[e("i",{class:"bi bi-credit-card me-2"},null,-1),u(" Checkout ",-1)])]),e("button",{class:"btn btn-outline-danger w-100",onClick:t[1]||(t[1]=(...m)=>r.clearCart&&r.clearCart(...m)),type:"button"},[...t[9]||(t[9]=[e("i",{class:"bi bi-trash me-2"},null,-1),u(" Clear Cart ",-1)])])])]))]),C(b,{ref:"checkoutModal"},null,512)])}const me=y(Yt,[["render",ue],["__scopeId","data-v-8b9549ed"]]),he={name:"POS",components:{SearchBar:E,ProductGrid:tt,Cart:me},data(){return{products:[],categories:[],selectedCategory:null,searchQuery:""}},computed:{filteredProducts(){let s=this.products;if(this.selectedCategory!==null&&(s=s.filter(t=>t.category.id===this.selectedCategory)),this.searchQuery){const t=this.searchQuery.toLowerCase();s=s.filter(a=>a.name.toLowerCase().includes(t)||a.barcode&&a.barcode.includes(t))}return s}},mounted(){this.fetchProducts(),this.fetchCategories(),window.addEventListener("keydown",this.handleKeydown)},beforeUnmount(){window.removeEventListener("keydown",this.handleKeydown)},methods:{async fetchProducts(){try{const s=await q.getAll(1);this.products=s.data}catch{h().error("Failed to load products")}},async fetchCategories(){try{this.categories=await V.getAll()}catch{h().error("Failed to load categories")}},async handleSearch(s){if(this.searchQuery=s,!s){this.fetchProducts();return}try{const t=await q.search(s);this.products=t}catch{h().error("Search failed")}},filterByCategory(s){this.selectedCategory=s,this.searchQuery="",this.fetchProducts()},addToCart(s){if(s.stock_quantity<=0){h().error("Product out of stock");return}g().addItem(s),h().success(`${s.name} added to cart`)},handleKeydown(s){if(s.key==="F9"&&(s.preventDefault(),g().items.length>0?this.$root.$refs.cart?.openCheckout():h().error("Cart is empty")),s.key==="Escape"){s.preventDefault();const t=g();t.items.length>0&&confirm("Are you sure you want to clear the cart?")&&(t.clearCart(),h().success("Cart cleared"))}}}},be={class:"row"},fe={class:"col-lg-8 col-md-7"},ye={class:"category-tabs mb-4"},pe={class:"btn-group w-100",role:"group"},_e=["onClick"],ge={class:"col-lg-4 col-md-5"};function ve(s,t,a,c,n,r){const o=_("SearchBar"),b=_("ProductGrid"),m=_("Cart");return i(),l("div",{class:"container-fluid",onKeydown:t[1]||(t[1]=(...f)=>r.handleKeydown&&r.handleKeydown(...f))},[e("div",be,[e("div",fe,[t[2]||(t[2]=e("div",{class:"d-flex justify-content-between align-items-center mb-4"},[e("h2",{class:"mb-0"},"Point of Sale"),e("div",{class:"keyboard-hints"},[e("small",{class:"text-muted"},[e("kbd",null,"F9"),u(" Checkout • "),e("kbd",null,"Esc"),u(" Clear Cart ")])])],-1)),C(o,{onSearch:r.handleSearch,class:"mb-4"},null,8,["onSearch"]),e("div",ye,[e("div",pe,[e("button",{type:"button",class:k(["btn btn-outline-primary",{active:n.selectedCategory===null}]),onClick:t[0]||(t[0]=f=>r.filterByCategory(null))}," All Products ",2),(i(!0),l(S,null,x(n.categories,f=>(i(),l("button",{key:f.id,type:"button",class:k(["btn btn-outline-primary",{active:n.selectedCategory===f.id}]),onClick:Ce=>r.filterByCategory(f.id)},d(f.name),11,_e))),128))])]),C(b,{products:r.filteredProducts,onAddToCart:r.addToCart},null,8,["products","onAddToCart"])]),e("div",ge,[C(m)])])],32)}const Te=y(he,[["render",ve],["__scopeId","data-v-c7bb34e6"]]);export{Te as default};
